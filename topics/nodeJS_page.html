<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Node.js CheatSheet</title>
	<link rel="stylesheet" type="text/css" href="../CSS/styles.css">
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">  
</head>
<body>
	<header>
	<h1>Node.js CheatSheet</h1>
		<nav id="nav">
			<ul class="nav_bar">
				<li><a href="#terminal" class="nav_bar_button">Terminal Commands</a></li>
				<li><a href="#modules" class="nav_bar_button">Modules</a></li>
				<li><a href="#package" class="nav_bar_button">package.json</a></li>
				<li><a href="#init" class="nav_bar_button">Node server initialization</a></li>
				<li><a href="#express" class="nav_bar_button">Express</a></li>
				<li><a href="#mongoose" class="nav_bar_button">Mongoose</a></li>
			</ul>
			<a href="../index.html" class="homepage_button">Back to Homepage</a>
		</nav>
	</header>

	<main>

		<!-- About Terminal Commands -->

		<section>
			<h2 id="terminal">Terminal Commands</h2>
			<table class="table">
				<thead>
					<th><h3>Code</h3></th>
					<th><h3>Meaning</h3></th>
				</thead>
				<tbody>
                    <tr>
						<td>node -v</td>
						<td>Checks the installed version of Node.js.</td>
					</tr>
					<tr>
						<td>node</td>
						<td>Accesses the REPL.</td>
					</tr>
					<tr>
						<td>.editor</td>
						<td>Enters editor mode.</td>
					</tr>
					<tr>
						<td>global</td>
						<td>Accesses the global object in REPL.</td>
					</tr>
					<tr>
						<td>node 'program name'</td>
						<td>Runs a program.</td>
					</tr>
					<tr>
						<td>require('module').builtinModules</td>
						<td>Get a list of the Core Modules.</td>
					</tr>
					<tr>
						<td>node server</td>
						<td>Logs the data of the server in the terminal.</td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					
				</tbody>
			</table>
		</section>

        		<!-- About Modules -->

		<section>
			<h2 id="modules">Modules</h2>
			<table class="table">
				<thead>
					<th><h3>Code</h3></th>
					<th><h3>Meaning</h3></th>
				</thead>
				<tbody>
                    <tr>
						<td>require()</td>
						<td></td>
					</tr>
					<tr>
						<td>console.log()</td>
						<td>Logs a command.</td>
					</tr>
					<tr>
						<td>console.table()</td>
						<td>Prints a table.</td>
					</tr>
					<tr>
						<td>console.assert()</td>
						<td>Asserts stuff.</td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					
				</tbody>
			</table>
		</section>

		<!-- About packege.json -->

		<section>
			<h2 id="package">package.json</h2>
			<table class="table">
				<thead>
					<th><h3>Code</h3></th>
					<th><h3>Meaning</h3></th>
				</thead>
				<tbody>
                    <tr>
						<td>"name": "project's name"</td>
						<td></td>
					</tr>
					<tr>
						<td>"author": "author's name"</td>
						<td></td>
					</tr>
					<tr>
						<td>"description" : "description of the project"</td>
						<td></td>
					</tr>
					<tr>
						<td>"license": "license type"</td>
						<td>MIT, BSD... Add a LICENSE file in the project too !</td>
					</tr>
					<tr>
						<td>"version": "current version of the project"</td>
						<td></td>
					</tr>
					<tr>
						<td>"keywords": ["array of keywords defining the project"]</td>
						<td></td>
					</tr>
					<tr>
						<td>"dependencies": {"package1": "package1 version", "package2": "package2 version"}</td>
						<td>Very important, allows npm to install the packages, version as major.minor.patch, ~ to automaticaly install latest patch, ^ to automaticaly install latest minor update.</td>
					</tr>
				</tbody>
			</table>
		</section>

		<!-- About Server init -->

		<section>
			<h2 id="init">Server initialization</h2>
			<table class="table">
				<thead>
					<th><h3>Code</h3></th>
					<th><h3>Meaning</h3></th>
				</thead>
				<tbody>
					<tr>
						<td>Create backend folder</td>
						<td></td>
					</tr>
					<tr>
						<td>npm init</td>
						<td>Initialize the node project</td>
					</tr>
					<tr>
						<td>ni server.js</td>
						<td>Create server.js</td>
					</tr>
					<tr>
						<td>ni .gitignore >> node_modules</td>
						<td>Creates the gitignore file to ignore node_modules</td>
					</tr>
					<tr>
						<td>git init</td>
						<td>Initializes the repository</td>
					</tr>
					<tr>
						<td>const http = require('http'); <br> <br>
							const server = http.createServer((req, res) => { <br>
								res.end('Voilà la réponse du serveur !'); <br>
							}); <br> <br>	
							server.listen(process.env.PORT || 3000);</td>
						<td>Initializes the server port.</td>
					</tr>
					<tr>
						<td>const http = require('http');<br>
							const app = require('./app');<br>
							app.set('port', process.env.PORT || 3000);<br>
							const server = http.createServer(app);<br>
							server.listen(process.env.PORT || 3000);</td>
						<td>Initializes the server with the app.</td>
					</tr>
					<tr>
						<td>npm install -g nodemon</td>
						<td>Installs nodemon</td>
					</tr>
					<tr>
						<td>nodemon server</td>
						<td>Init Nodemon (actualises the server in real time).</td>
					</tr>
					<tr>
						<td>function normalizePort(val) {<br>
							var port = parseInt(val, 10);<br>
						  
							if (isNaN(port)) {<br>
							  // named pipe <br>
							  return val;<br>
							}<br>
						  <br>
							if (port >= 0) {<br>
							  // port number<br>
							  return port;<br>
							}<br>
							<br>
							return false;<br>
						  }</td>
						<td>Makes sure the port is returning a number.</td>
					</tr>
					<tr>
						<td>const errorHandler = error => {</br>
							if (error.syscall !== 'listen') {</br>
							  throw error;</br>
							}</br>
							const address = server.address();</br>
							const bind = typeof address === 'string' ? 'pipe ' + address : 'port: ' + port;</br>
							switch (error.code) {</br>
							  case 'EACCES':</br>
								console.error(bind + ' requires elevated privileges.');</br>
								process.exit(1);</br>
								break;</br>
							  case 'EADDRINUSE':</br>
								console.error(bind + ' is already in use.');</br>
								process.exit(1);</br>
								break;</br>
							  default:</br>
								throw error;</br>
							}</br>
						    };<br>
						    server.on('error', errorHandler);</td>
						<td>Error handling function.</td>
					</tr>
					<tr>
						<td>server.on('listening', () => {<br>
							const address = server.address();<br>
							const bind = typeof address === 'string' ? 'pipe ' + address : 'port ' + port;<br>
							console.log('Listening on ' + bind);<br>
						  });<br>
						  <br>
						  server.listen(port);</td>
						<td>Server event listener that logs the port or canal used by the server.</td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					
				</tbody>
			</table>
		</section>

					<!-- About Express -->

		<section>
			<h2 id="express">Express</h2>
				<table class="table">
					<thead>
						<th><h3>Code</h3></th>
						<th><h3>Meaning</h3></th>
					</thead>
					<tbody>
						
						<tr>
							<td>npm install express --save</td>
							<td>Installs express and saves it in package.json</td>
						</tr>
						<tr>
							<td>Create app.js file</td>
							<td>The file where the app is gonna be built.</td>
						</tr>
						<tr>
							<td>const express = require('express');</td>
							<td>Imports express in app.js</td>
						</tr>
						<tr>
							<td>const app = express();</td>
							<td>Enables the creation of an express app</td>
						</tr>
						<tr>
							<td>app.use((req, res) => {<br>
								res.json({message: 'Your request has been received.'});<br>
							})</td>
							<td>Creates a response to the server.</td>
						</tr>
						<tr>
							<td>module.exports = app;</td>
							<td>So it can be accessed from the other files of the project (node server included).</td>
						</tr>
						<tr>
							<td>app.use((req, res, next) => {<br>
								smthg to do;<br>
								next();<br>
							}); </td>
							<td>Parameter (next) and function (next()) used to send a request from middleware to middleware.</td>
						</tr>
						<tr>
							<td>app.use('/api/stuff', (req, res, next) => {<br>
							})
							</td>
							<td>The first argument is the url path of where the middleware is supposed to be recorded.</td>
						</tr>
						<tr>
							<td>app.use((req, res, next) => {<br>
								res.setHeader('Access-Control-Allow-Origin', '*');<br>
								res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content, Accept, Content-Type, Authorization');<br>
								res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');<br>
								next();<br>
							});</td>
							<td>Grants API access to any user.</td>
						</tr>
						<tr>
							<td>app.use(express.json());</td>
							<td>Handle posts requests with a Content-Type application/json by extracting a json objects and sending it to the server (we can use body parser too).</td>
						</tr>
						<tr>
							<td>app.get() app.post()</td>
							<td>Function used to get or post data.</td>
						</tr>
						<tr>
							<td>app.use()</td>
							<td>Responds to both get and post requests.</td>
						</tr>
						<tr>
							<td>const Thing = require('../models/Thing');</td>
							<td>Imports the database model inside the app.</td>
						</tr>
						<tr>
							<td>...req.body</td>
							<td>Copies all the key/value pairs of the request body.</td>
						</tr>
						<tr>
							<td>app.post('/api/stuff', (req, res, next) => {<br>
								delete req.body._id;<br>
								const thing = new Thing({<br>
									...req.body<br>
								});<br>
								thing.save()<br>
								.then(() => res.status(201).json({ message: 'Objet enregistré !'}))<br>
								.catch(error => res.status(400).json({ error }));<br>
							});</td>
							<td>Snippet for a post request that parses the body of the database model object without the id and saves it in the database.</td>
						</tr>
						<tr>
							<td>app.get('/api/stuff', (req, res, next) => {<br>
								Thing.find()<br>
								.then(things => res.status(200).json(things))<br>
								.catch(error => res.status(400).json({ error }));<br>
							  });</td>
							<td>Snippet for a get request with the find() method that sends all the objects from the database.</td>
						</tr>
						<tr>
							<td>app.get('/api/stuff/:id', (req, res, next) => {<br>
								Thing.findOne({ _id: req.params.id })<br>
								.then(thing => res.status(200).json(thing))<br>
								.catch(error => res.status(404).json({ error }));<br>
							});</td>
							<td>Snippet for a get request with the findOne() method that sends only one object (identified by its _id) from the the database.</td>
						</tr>
						<tr>
							<td>app.put('/api/stuff/:id', (req, res, next) => { <br>
								Thing.updateOne({ _id: req.params.id }, { ...req.body, _id: req.params.id }) <br>
								.then(() => res.status(200).json({ message: 'Objet modifié !'})) <br>
								.catch(error => res.status(400).json({ error })); <br>
							});</td>
							<td>Code snippet for an update request that replace the body of an object by another one.</td>
						</tr>
						<tr>
							<td>app.delete('/api/stuff/:id', (req, res, next) => { <br>
								Thing.deleteOne({ _id: req.params.id }) <br>
								.then(() => res.status(200).json({ message: 'Objet supprimé !'})) <br>
								.catch(error => res.status(400).json({ error })); <br>
							});</td>
							<td></td>
						</tr>
						<tr>
							<td>res.send("string")</td>
							<td>Sends a string as a server's response.</td>
						</tr>
						<tr>
							<td>res.sendFile(__dirname + "/public/index.html");</td>
							<td>Sends the html file of the project as a server's response.</td>
						</tr>
						<tr>
							<td>app.use("/public", express.static(__dirname + "/public"));</td>
							<td>Serves the assets in the public folder.</td>
						</tr>
						<tr>
							<td>.env file</td>
							<td>Secret file containing parameters</td>
						</tr>
						<tr>
							<td>VAR_NAME=parameter</td>
							<td>Creates a variable in the .env file.</td>
						</tr>
						<tr>
							<td>process.env.VAR_NAME</td>
							<td>Accessing the .env variable from the app.</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						
					</tbody>
				</table>
			</section>

		<!-- About Mongoose -->

			<section>
				<h2 id="mongoose">Mongoose</h2>
				<table class="table">
					<thead>
						<th><h3>Code</h3></th>
						<th><h3>Meaning</h3></th>
					</thead>
					<tbody>				
						<tr>
							<td>npm install mongoose</td>
							<td>Installs Mongoose</td>
						</tr>
						<tr>
							<td>const mongoose = require('mongoose')</td>
							<td>Imports mongoose in the app file.</td>
						</tr>
						<tr>
							<td>mongoose.connect('mongodb+srv://jimbob:<PASSWORD>@cluster0-pme76.mongodb.net/test?retryWrites=true&w=majority',<br>
								{ useNewUrlParser: true,<br>
								  useUnifiedTopology: true })<br>
								.then(() => console.log('Successful MongoDB connection !'))<br>
								.catch(() => console.log('Connection to MongoDB failed !'));</td>
							<td>Connects the app to MongoDB</td>
						</tr>
						<tr>
							<td>const mongoose = require('mongoose');<br><br>

								const thingSchema = mongoose.Schema({<br>
									title: { type: String, required: true },<br>
									description: { type: String, required: true },<br>
									imageUrl: { type: String, required: true },<br>
									userId: { type: String, required: true },<br>
									price: { type: String, required: true }<br>
								});<br>
								<br>
								module.export = mongoose.model('Thing', thingSchema);
							</td>
							<td>Database model exemple in Thing.js inside models folder.</td>
						</tr>
						<tr>
							<td>const Schema = mongoose.Schema;<br><br>

								const personSchema = new Schema({ <br>
								  name: { type: String, required: true}, <br>
								  age: Number, <br>
								  favoriteFoods: [String] <br>
								}); </td>
							<td>Creation of a mongoose schéma.</td>
						</tr>
						<tr>
							<td>var Person = mongoose.model("Person", personSchema);<br>

								var createAndSavePerson = (done) => { <br>
								  var janeDoe = new Person({ name: "Jane Doe", age: 54, favoriteFoods: ['banana', 'apricot', 'bamburger']}); <br>
								  janeDoe.save((err, data) => { <br>									
									if (err) return console.error(err);<br>
									done(null, data);<br>
								  });<br>
								};
								</td>
							<td>Creates an instance of the previous schema.</td>
						</tr>
						<tr>
							<td>const createManyPeople = (arrayOfPeople, done) => { <br>
								Person.create(arrayOfPeople, (err, people) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, people); <br>
								}); <br>
							  };</td>
							<td>Create multiple instances of a schema via an array of object.</td>
						</tr>
						<tr>
							<td>const findPeopleByName = (personName, done) => { <br>
								Person.find({ name: personName }, (err, name) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, name); <br>
								}) <br>
							  };</td>
							<td>Returns the given data inside a schema as an array.</td>
						</tr>
						<tr>
							<td>const findOneByFood = (food, done) => { <br>
								Person.findOne({ favoriteFoods: food }, (err, food) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, food); <br>
								}); <br>
							  };</td>
							<td>Return only one element, not an array.</td>
						</tr>
						<tr>
							<td>const findPersonById = (personId, done) => { <br>
								Person.findById({ _id: personId }, (err, personId) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, personId); <br>
								}); <br>
							  };</td>
							<td>Use the _id key to return an instance of a given schema.</td>
						</tr>
						<tr>
							<td>const findEditThenSave = (personId, done) => { <br>
								const foodToAdd = "hamburger"; <br>
								Person.findById(personId, (err, person) => { <br>
								  if(err) return console.error(err); <br>
								  person.favoriteFoods.push(foodToAdd); <br>
								  person.save((err, updatePerson) => { <br>
									if(err) return console.error(err); <br>
									done(null, updatePerson); <br>
								  }); <br>
								}); <br>
							  };</td>
							<td>Finds a schema instance by id, modifies it (.push()) and saves it.</td>
						</tr>
						<tr>
							<td>const findAndUpdate = (personName, done) => { <br>
								const ageToSet = 20; <br>
								Person.findOneAndUpdate({ name: personName }, { age: ageToSet }, { new: true }, (err, updateDoc) => { <br>
								  if(err) return console.error(err); <br>
								  done(null, updateDoc); <br>
								}); <br>
							  };</td>
							<td>ShortHand version of the previous function (see also findByIdAndUpdate()).</td>
						</tr>
						<tr>
							<td>const removeById = (personId, done) => { <br>
								Person.findByIdAndRemove(personId, (err, person) => { <br>
								  if(err) return console.error(err); <br>
								  done(null, person); <br>
								}); <br>
							  };</td>
							<td>Finds a schema instance by id and deletes it (see also findOneAndRemove(), findByIdAndDelete(), findOneAndDelete()).</td>
						</tr>
						<tr>
							<td>const removeManyPeople = (done) => { <br>
								const nameToRemove = "Mary"; <br>
								Person.deleteMany({ name: nameToRemove }, (err, name) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, name); <br>
								}); <br>
							  };</td>
							<td>Deletes as many elements as necessary.</td>
						</tr>
						<tr>
							<td>const queryChain = (done) => { <br>
								const foodToSearch = "burrito";
								Person.find({ favoriteFoods: foodToSearch}).sort({ name: 1 }).limit(2).select({ age: 0 }).exec((err, data) => { <br>
								  if (err) return console.error(err); <br>
								  done(null, data); <br>
								}); <br>
							  };</td>
							<td>Exemple of chain search.</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
								
					</tbody>
				</table>
			</section>

			<!-- About Routing -->

		<section>
			<h2 id="routing">Routing</h2>
			<table class="table">
				<thead>
					<th><h3>Code</h3></th>
					<th><h3>Meaning</h3></th>
				</thead>
				<tbody>
					<tr>
						<td>const.router = express.Router();</td>
						<td>Creates a router.</td>
					</tr>
					<tr>
						<td>router.get()/.post()/.put()/.delete()</td>
						<td>Creates routes from the router.</td>
					</tr>
					<tr>
						<td>module.exports = router;</td>
						<td>Exports the router module.</td>
					</tr>
					<tr>
						<td>const stuffRoutes = require('./routes/router');</td>
						<td>Imports the router module.</td>
					</tr>
					<tr>
						<td></td>
						<td></td>
					</tr>
					
				</tbody>
			</table>
		</section>
	</main>
</body>